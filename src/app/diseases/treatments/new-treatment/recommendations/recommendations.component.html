<mat-toolbar class="pt-1">
	<button mat-icon-button class="mt-1" aria-label="Return button" (click)="return()">
		<mat-icon>arrow_back</mat-icon>
	</button>
	<span class="text-title-large">New recommendation</span>
	<span class="flex-1"></span>
	<button mat-icon-button class="mt-1" aria-label="Return button" (click)="save()" [disabled]="!isFormValid()">
		<mat-icon>save</mat-icon>
	</button>
</mat-toolbar>

<div class="m-4">

	<form [formGroup]="form" class="grid--center">
		<mat-form-field floatLabel="always" appearance="fill" class="grid__cell">
			<mat-label>Medication</mat-label>
			<input required matInput formControlName="name">
		</mat-form-field>

		<mat-accordion formArrayName="frequencyEntries">
			<mat-expansion-panel *ngFor="let entry of frequencyEntries.controls; let i = index" [formGroupName]="i">
				<mat-expansion-panel-header>
					<mat-panel-title>
						Entry {{ i + 1 }}
					</mat-panel-title>
					<button (click)="removeDosageEntryButtonClicked(i)" mat-icon-button type="button">
						<mat-icon>delete</mat-icon>
					</button>
					<!-- <mat-panel-description>
					</mat-panel-description> -->
				</mat-expansion-panel-header>

				<div class="grid__cell">
					<mat-form-field appearance="fill">
						<mat-label>Dosage</mat-label>
						<input matInput formControlName="dosage">
					</mat-form-field>
				</div>

				<mat-form-field appearance="fill" class="grid__cell">
					<mat-label>When</mat-label>
					<mat-select (selectionChange)="onSelectionChange($event, i)" formControlName="when">
						<mat-option value="custom">Custom</mat-option>
						<mat-option value="Morning">Morning</mat-option>
						<mat-option value="Evening">Evening</mat-option>
					</mat-select>
				</mat-form-field>

				<mat-form-field class="grid__cell" *ngIf="isCustomFormVisible(i)" appearance="fill">
					<mat-label>When - Custom</mat-label>
					<input matInput formControlName="whenCustom">
				</mat-form-field>
			</mat-expansion-panel>
		</mat-accordion>

		<button class="grid__cell" (click)="addNewDosageButtonClicked()" mat-fab color="primary" type="button">
			<mat-icon>add</mat-icon>
		</button>
	</form>
</div>